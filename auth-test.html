<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Authentication - Confab Web Oasis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; }
        .test-section { margin-bottom: 30px; border: 1px solid #ddd; padding: 20px; border-radius: 8px; }
        .result { background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Authentication Test Page</h1>
        <p>Trang này giúp kiểm tra tình trạng xác thực hiện tại</p>
        
        <div class="test-section">
            <h3>1. Kiểm tra Global Variables</h3>
            <div id="global-vars" class="result">Đang kiểm tra...</div>
        </div>
        
        <div class="test-section">
            <h3>2. Kiểm tra Functions</h3>
            <div id="functions" class="result">Đang kiểm tra...</div>
        </div>
        
        <div class="test-section">
            <h3>3. Kiểm tra localStorage</h3>
            <div id="localstorage" class="result">Đang kiểm tra...</div>
        </div>
        
        <div class="test-section">
            <h3>4. Test API Call</h3>
            <button class="btn btn-primary" onclick="testApiCall()">Test API Profile</button>
            <div id="api-result" class="result mt-2">Chưa test...</div>
        </div>
        
        <div class="test-section">
            <h3>5. Actions</h3>
            <button class="btn btn-success" onclick="window.debugAuthState()">Debug Auth State</button>
            <button class="btn btn-warning" onclick="location.href='login.html'">Go to Login</button>
            <button class="btn btn-info" onclick="location.href='conferences.html'">Go to Conferences</button>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script src="js/auth-debug.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Test 1: Global Variables
            let globalVars = [];
            globalVars.push('window.authCurrentUser: ' + (typeof window.authCurrentUser !== 'undefined' ? JSON.stringify(window.authCurrentUser) : 'undefined'));
            globalVars.push('window.getCurrentUser: ' + (typeof window.getCurrentUser === 'function' ? 'function exists' : 'undefined'));
            globalVars.push('window.isLoggedIn: ' + (typeof window.isLoggedIn === 'function' ? 'function exists' : 'undefined'));
            document.getElementById('global-vars').innerHTML = globalVars.join('<br>');
            
            // Test 2: Functions
            let functions = [];
            if (typeof window.isLoggedIn === 'function') {
                try {
                    functions.push('window.isLoggedIn(): ' + window.isLoggedIn());
                } catch (e) {
                    functions.push('window.isLoggedIn(): ERROR - ' + e.message);
                }
            }
            
            if (typeof window.getCurrentUser === 'function') {
                try {
                    const user = window.getCurrentUser();
                    functions.push('window.getCurrentUser(): ' + JSON.stringify(user));
                } catch (e) {
                    functions.push('window.getCurrentUser(): ERROR - ' + e.message);
                }
            }
            document.getElementById('functions').innerHTML = functions.join('<br>');
            
            // Test 3: localStorage
            let localStorageInfo = [];
            const storedUser = localStorage.getItem('user');
            localStorageInfo.push('localStorage.user: ' + (storedUser ? storedUser : 'not found'));
            const storedToken = localStorage.getItem('token');
            localStorageInfo.push('localStorage.token: ' + (storedToken ? storedToken : 'not found'));
            document.getElementById('localstorage').innerHTML = localStorageInfo.join('<br>');
        });
        
        async function testApiCall() {
            try {
                const response = await fetch('api/users.php?action=profile', {
                    method: 'GET',
                    credentials: 'include'
                });
                
                const result = await response.json();
                document.getElementById('api-result').innerHTML = 'Status: ' + response.status + '<br>Result: ' + JSON.stringify(result, null, 2);
            } catch (error) {
                document.getElementById('api-result').innerHTML = 'ERROR: ' + error.message;
            }
        }
    </script>
</body>
</html>
